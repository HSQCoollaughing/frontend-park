(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f9696020"],{"04d1":function(t,e,n){var a=n("342f"),o=a.match(/firefox\/(\d+)/i);t.exports=!!o&&+o[1]},"0c1f":function(t,e,n){},"27a3":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"content",style:"background:"+t.background},[t._m(0),n("canvas",{ref:"canvas",attrs:{id:"canvas",width:"800",height:"800"}})]),n("div",{staticClass:"operations"},[n("div",{staticStyle:{height:"800px"}},[n("EasyForm",{attrs:{formParams:t.formParams},scopedSlots:t._u([{key:"inputFile",fn:function(e){return[n("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.inputFile}},[t._v(" 选择文件 ")]),n("div",[t._v("共选择"+t._s(t.imgList.length)+"个文件")])]}}])}),n("el-button",{attrs:{type:"primary",size:"default"},on:{click:t.reload}},[t._v("重置")]),n("el-button",{attrs:{type:"primary",size:"default"},on:{click:t.generateImg}},[t._v("生成图片")]),n("el-button",{attrs:{type:"success",size:"default"},on:{click:t.exportCanvas}},[t._v("导出图片")])],1)])])},o=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{"text-align":"left",width:"800px"}},[n("p",[t._v("使用方法:")]),n("p",{staticStyle:{"font-size":"12px"}},[t._v(" 选取目标文件后,再选取需要用来合成目标文件的素材图片,通过自定义的一些配置,生成像素图,点击导出图片即可 ")])])}],i=n("1da1");n("96cf"),n("4e82"),n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),n("99af");function r(t){return new Promise((function(e,n){try{var a=document.createElement("canvas");a.width=20,a.height=20;var o=new Image;o.src=t,o.onload=function(){console.log(o.width,o.height);var n=a.getContext("2d"),i=a.height/o.height;o.height=a.height,o.width=o.width*i,n.drawImage(o,0,0,a.width,a.height);for(var r=n.getImageData(0,0,a.width,a.height).data,c=0,s=0,l=0,h=0,d=0;d<a.height;d++)for(var u=0;u<a.width;u++)c+=r[4*(a.width*d+u)],s+=r[4*(a.width*d+u)+1],l+=r[4*(a.width*d+u)+2],h+=r[4*(a.width*d+u)+3];c/=a.width*a.height,s/=a.width*a.height,l/=a.width*a.height,h/=a.width*a.height,c=Math.round(c),s=Math.round(s),l=Math.round(l),h=Math.round(h),console.log("%c ".concat("rgba("+c+","+s+","+l+","+h+")","\n                                                                        "),"background: ".concat("rgba("+c+","+s+","+l+","+h+")",";")),e({color:[c,s,l,h],url:t})}}catch(i){n(i)}}))}var c=n("0a07");n("ac1f"),n("1276");function s(t){for(var e=[],n=0;n<t.length;n++){for(var a=[],o="",i=0;i<t[i].color.length;i++)o=t[n].color[i],o in a?++a[o]:a[o]=1;var r=[];for(var c in a)r.push({color:c.split(","),count:a[c]});r.sort((function(t,e){return e.count-t.count})),r[0].position=t[n].position,e.push(r[0])}return e}var l=n("7a94"),h={components:{},data:function(){return{imgList:[],blockList:[],blockMainColors:[],loading:!1,formParams:{data:{},formList:{targetFile:{type:"upload",label:"目标图片",limit:1,action:"#",listType:"file-list",fileList:[],autoUpload:!1,onChange:this.slectFile},inputFile:{type:"customItem",label:"素材图片",name:"inputFile"},aaa:{type:"select",label:"分布方式",placeholder:"请选择",selectOptions:[],disabled:!0},bbb:{type:"select",label:"高清程度",placeholder:"请选择",selectOptions:[],disabled:!0},ccc:{type:"switch",label:"连续重复:",placeholder:"请选择",disabled:!0},ddd:{type:"switch",label:"按比例调整",disabled:!0},eee:{type:"select",label:"方向／比例",selectOptions:[],disabled:!0},fff:{type:"slider",label:"贴片高度",disabled:!0},ggg:{type:"slider",label:"贴片宽度",disabled:!0}},labelWidth:"90px",rules:{}},background:"#91A8D0",ctx:null,canvas:null}},mounted:function(){this.initCanvas()},methods:{initCanvas:function(){this.canvas=new l["fabric"].Canvas("canvas",{isDrawingMode:!1,selectable:!1,selection:!1,hoverCursor:"pointer",devicePixelRatio:!0,stroke:"lightgreen",strokeWidth:4}),this.ctx=canvas.getContext("2d"),this.canvas.freeDrawingBrush.color="blue",this.canvas.freeDrawingBrush.width=5,this.addCanvasEvent()},reload:function(){console.log(this.canvas.viewportTransform),this.canvas.deactivateAll().renderAll()},generateImg:function(){var t=this;this.loading=!0;for(var e=[],n=0;n<this.blockMainColors.length;n++){e[n]={diffs:[]};for(var a=0;a<this.imgList.length;a++)e[n].diffs.push({url:this.imgList[a].url,diff:this.colorDiff(this.blockMainColors[n].color,this.imgList[a].color),color:this.imgList[a].color});e[n].diffs.sort((function(t,e){return t.diff-e.diff})),e[n].url=e[n].diffs[0].url,e[n].position=this.blockMainColors[n].position,e[n].Acolor=this.blockMainColors[n].color,e[n].Bcolor=e[n].diffs[0].color}this.loading=!1,console.log(e),e.forEach((function(e){l["fabric"].Image.fromURL(e.url,(function(n){var a=n.height>n.width?8/n.width:8/n.height;n.set({left:8*e.position[0],top:8*e.position[1],originX:"center",scaleX:a,scaleY:a}),t.canvas.add(n)}))}))},slectFile:function(t,e){var n=window.URL.createObjectURL(t.raw);this.drawImage(n)},inputFile:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(c["a"])();case 2:n=e.sent,t.loading=!0,a=0;case 5:if(!(a<n.length)){e.next=13;break}return e.next=8,r(n[a]);case 8:o=e.sent,t.imgList.push(o);case 10:a++,e.next=5;break;case 13:console.log(t.imgList),t.loading=!1;case 15:case"end":return e.stop()}}),e)})))()},drawLine:function(){for(var t=8,e=0;e<=this.canvas.width/t;e++)this.canvas.add(new l["fabric"].Line([e*t,0,e*t,this.canvas.height],{left:e*t,stroke:"gray",selectable:!1})),this.canvas.add(new l["fabric"].Line([0,e*t,this.canvas.height,e*t],{top:e*t,stroke:"gray",selectable:!1}))},getCanvasData:function(){for(var t=0;t<this.canvas.height/8;t++)for(var e=0;e<this.canvas.width/8;e++){var n=this.ctx.getImageData(8*e,8*t,8,8).data;this.blockList[100*t+e]={position:[e,t],color:[]};for(var a=0;a<n.length;a+=4)this.blockList[100*t+e].color.push([n[a],n[a+1],n[a+2],n[a+3]])}console.log(s(this.blockList)),this.mostBlockColor(this.blockList),this.loading=!1},drawImage:function(t){var e=this;this.loading=!0,l["fabric"].Image.fromURL(t,(function(t){var n=t.height>t.width?e.canvas.width/t.width:e.canvas.height/t.height;t.set({left:e.canvas.width/2,originX:"center",originY:"center",top:e.canvas.height/2,scaleX:n,scaleY:n,selectable:!1}),t.on("added",(function(t){setTimeout((function(){e.getCanvasData()}),500)})),e.canvas.add(t)}))},mostBlockColor:function(t){for(var e=0;e<t.length;e++){for(var n=0,a=0,o=0,i=0,r=0;r<t[e].color[r].length;r++)n+=t[e].color[r][0],a+=t[e].color[r][1],o+=t[e].color[r][2],i+=t[e].color[r][3];n/=t[e].color[0].length,a/=t[e].color[0].length,o/=t[e].color[0].length,i/=t[e].color[0].length,n=Math.round(n),a=Math.round(a),o=Math.round(o),i=Math.round(i),this.blockMainColors.push({position:t[e].position,color:[n,a,o,i]})}console.log(this.blockMainColors)},colorDiff:function(t,e){for(var n=0,a=0;a<t.length;a++)n+=Math.pow(t[a]-e[a],2);return Math.sqrt(n)},addCanvasEvent:function(){var t=this;this.canvas.on("after:render",(function(t){})),this.canvas.on("object:added",(function(t){})),this.canvas.on("mouse:down",(function(e){if(e.e.ctrlKey){var n=t.canvas.getPointer(e.e),a=parseInt(n.x),o=parseInt(n.y),i=t.ctx.getImageData(a,o,1,1).data;console.log("%c x,y:(".concat(a,",").concat(o,")/rgba(").concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(i[3],")"),"background: rgba(".concat(i[0],",").concat(i[1],",").concat(i[2],",").concat(i[3],");"))}})),this.canvas.on("mouse:wheel",(function(e){e.e.preventDefault(),e.e.stopPropagation();var n=.05,a=new l["fabric"].Point(t.canvas.width/2-1,t.canvas.height/2-1);e.e.ctrlKey&&(e.e.altKey&&e.e.ctrlKey&&(a=new l["fabric"].Point(e.pointer.x,e.pointer.y)),t.zoom=(e.e.deltaY>0?-n:n)+t.canvas.getZoom(),t.zoom=Math.max(.1,t.zoom),t.zoom=Math.min(10,t.zoom),t.canvas.zoomToPoint(a,t.zoom))})),this.canvas.on({"mouse:down":function(e){e.e.altKey&&(t.panning=!0,t.canvas.selection=!1)},"mouse:up":function(e){t.panning=!1,t.canvas.selection=!0},"mouse:move":function(e){if(t.panning&&e&&e.e){var n=new l["fabric"].Point(e.e.movementX,e.e.movementY);t.canvas.relativePan(n)}}}),this.canvas.on({"object:moving":function(t){console.log(t),t.target.opacity=.5},"object:modified":function(t){t.target.opacity=1}})},exportCanvas:function(){var t=this.canvas.toDataURL({width:this.canvas.width,height:this.canvas.height,left:0,top:0,format:"png"}),e=document.createElement("a");e.download="canvas.png",e.href=t,document.body.appendChild(e),e.click(),document.body.removeChild(e)}}},d=h,u=(n("58a6"),n("2877")),f=Object(u["a"])(d,a,o,!1,null,"03e0cd2c",null);e["default"]=f.exports},"4e82":function(t,e,n){"use strict";var a=n("23e7"),o=n("1c0b"),i=n("7b0b"),r=n("50c4"),c=n("d039"),s=n("addb"),l=n("a640"),h=n("04d1"),d=n("d998"),u=n("2d00"),f=n("512ce"),g=[],v=g.sort,p=c((function(){g.sort(void 0)})),m=c((function(){g.sort(null)})),b=l("sort"),w=!c((function(){if(u)return u<70;if(!(h&&h>3)){if(d)return!0;if(f)return f<603;var t,e,n,a,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(a=0;a<47;a++)g.push({k:e+a,v:n})}for(g.sort((function(t,e){return e.v-t.v})),a=0;a<g.length;a++)e=g[a].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return"DGBEFHACIJK"!==o}})),k=p||!m||!b||!w,y=function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:String(e)>String(n)?1:-1}};a({target:"Array",proto:!0,forced:k},{sort:function(t){void 0!==t&&o(t);var e=i(this);if(w)return void 0===t?v.call(e):v.call(e,t);var n,a,c=[],l=r(e.length);for(a=0;a<l;a++)a in e&&c.push(e[a]);c=s(c,y(t)),n=c.length,a=0;while(a<n)e[a]=c[a++];while(a<l)delete e[a++];return e}})},"512ce":function(t,e,n){var a=n("342f"),o=a.match(/AppleWebKit\/(\d+)\./);t.exports=!!o&&+o[1]},"58a6":function(t,e,n){"use strict";n("0c1f")},addb:function(t,e){var n=Math.floor,a=function(t,e){var r=t.length,c=n(r/2);return r<8?o(t,e):i(a(t.slice(0,c),e),a(t.slice(c),e),e)},o=function(t,e){var n,a,o=t.length,i=1;while(i<o){a=i,n=t[i];while(a&&e(t[a-1],n)>0)t[a]=t[--a];a!==i++&&(t[a]=n)}return t},i=function(t,e,n){var a=t.length,o=e.length,i=0,r=0,c=[];while(i<a||r<o)i<a&&r<o?c.push(n(t[i],e[r])<=0?t[i++]:e[r++]):c.push(i<a?t[i++]:e[r++]);return c};t.exports=a},d998:function(t,e,n){var a=n("342f");t.exports=/MSIE|Trident/.test(a)}}]);
//# sourceMappingURL=chunk-f9696020.dc9eb6bb.js.map